use pgc_codegen::{model_modules::ModelModules, request::Request};

#[test]
fn load_models() {
    // let model_modules = ModelModules::new(request);
    let file_generator = pgc_codegen::file_generator::FileGenerator::new(&request()).unwrap();
    let x = file_generator.render_files().unwrap();
    dbg!(x);
}

fn request() -> Request {
    serde_json::from_str(REQUEST).unwrap()
}

const REQUEST: &str = r#"{"catalog":{"schemas":[{"name":"public","enums":[],"models":[{"kind":"table","name":"author","columns":[{"name":"id","type":{"name":"uuid","display":"uuid","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":"gen_random_uuid()","is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":true,"foreign_table_name":null,"foreign_table_schema":null},{"name":"name","type":{"name":"text","display":"text","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null},{"name":"birthday","type":{"name":"date","display":"date","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":true,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null}]},{"kind":"table","name":"book","columns":[{"name":"id","type":{"name":"uuid","display":"uuid","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":"gen_random_uuid()","is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":true,"foreign_table_name":null,"foreign_table_schema":null},{"name":"title","type":{"name":"text","display":"text","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null},{"name":"author_id","type":{"name":"uuid","display":"uuid","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":true,"is_primary_key":false,"foreign_table_name":"author","foreign_table_schema":"public"},{"name":"year","type":{"name":"int4","display":"integer","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null},{"name":"isbn","type":{"name":"text","display":"text","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":true,"is_nullable":false,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null},{"name":"is_best_seller","type":{"name":"bool","display":"boolean","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":"false","is_unique":false,"is_nullable":true,"is_foreign_key":false,"is_primary_key":false,"foreign_table_name":null,"foreign_table_schema":null},{"name":"genre","type":{"name":"text","display":"text","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":true,"is_primary_key":false,"foreign_table_name":"genre","foreign_table_schema":"public"}]},{"kind":"table","name":"genre","columns":[{"name":"id","type":{"name":"text","display":"text","is_array":false,"schema_name":"pg_catalog","is_composite":false,"array_dimensions":0},"default":null,"is_unique":false,"is_nullable":false,"is_foreign_key":false,"is_primary_key":true,"foreign_table_name":null,"foreign_table_schema":null}]}]}]},"queries":[{"query":"select book from book where id = $1;","name":"fetch_by_id","command":"one","path":"book.sql","annotations":{"name":{"value":"fetch_by_id :one","line":2}},"output":[{"name":"book","type":{"schema":"public","name":"book","id":16401}}],"parameters":[{"name":"id","not_null":true,"type":{"schema":"pg_catalog","name":"uuid","id":2950}}]},{"query":"select author, book from author\njoin book on book.author_id = author.id\nwhere author.id = $1;","name":"fetch_by_author_id","command":"many","path":"book.sql","annotations":{"name":{"value":"fetch_by_author_id :many","line":5},"namespace":{"value":"book.author","line":6}},"output":[{"name":"author","type":{"schema":"public","name":"author","id":16386}},{"name":"book","type":{"schema":"public","name":"book","id":16401}}],"parameters":[{"name":"id","not_null":true,"type":{"schema":"pg_catalog","name":"uuid","id":2950}}]},{"query":"insert into book (\n    title,\n    author_id,\n    year,\n    isbn,\n    genre,\n    is_best_seller\n)\nvalues (\n    $1,\n    $2,\n    $3,\n    $4,\n    $5,\n    coalesce($6, false)\n)\non conflict (id) do update set\n    title =          $1,\n    author_id =      $2,\n    year =           $3,\n    isbn =           $4,\n    is_best_seller = coalesce($6, false),\n    genre =          $5\nreturning book;","name":"upsert","command":"one","path":"book.sql","annotations":{"name":{"value":"upsert :one","line":12}},"output":[{"name":"book","type":{"schema":"public","name":"book","id":16401}}],"parameters":[{"name":"book.title","not_null":true,"type":{"schema":"pg_catalog","name":"text","id":25}},{"name":"book.author_id","not_null":true,"type":{"schema":"pg_catalog","name":"uuid","id":2950}},{"name":"book.year","not_null":true,"type":{"schema":"pg_catalog","name":"int4","id":23}},{"name":"book.isbn","not_null":true,"type":{"schema":"pg_catalog","name":"text","id":25}},{"name":"book.genre","not_null":true,"type":{"schema":"pg_catalog","name":"text","id":25}},{"name":"book.is_best_seller","not_null":false,"type":{"schema":"pg_catalog","name":"bool","id":16}}]},{"query":"select author from author where id = $1;","name":"fetch_by_id","command":"one","path":"author.sql","annotations":{"name":{"value":"fetch_by_id :one","line":2}},"output":[{"name":"author","type":{"schema":"public","name":"author","id":16386}}],"parameters":[{"name":"id","not_null":true,"type":{"schema":"pg_catalog","name":"uuid","id":2950}}]},{"query":"select * from author;","name":"fetch_all","command":"many","path":"author.sql","annotations":{"name":{"value":"fetch_all :many","line":5}},"output":[{"name":"id","type":{"schema":"pg_catalog","name":"uuid","id":2950}},{"name":"name","type":{"schema":"pg_catalog","name":"text","id":25}},{"name":"birthday","type":{"schema":"pg_catalog","name":"date","id":1082}}],"parameters":[]},{"query":"select book\nfrom author\njoin book on author.id = book.author_id\nwhere author.id = $1;","name":"fetch_books","command":"many","path":"author.sql","annotations":{"name":{"value":"fetch_books :many","line":8}},"output":[{"name":"book","type":{"schema":"public","name":"book","id":16401}}],"parameters":[{"name":"id","not_null":true,"type":{"schema":"pg_catalog","name":"uuid","id":2950}}]},{"query":"select count(*) from author;","name":"count","command":"val","path":"author.sql","annotations":{"name":{"value":"count :val","line":15}},"output":[{"name":"count","type":{"schema":"pg_catalog","name":"int8","id":20}}],"parameters":[]}],"config":{"version":"1","queries":["book.sql","author.sql","queries.sql"],"disable_cache":false,"database":{"migrations":"schema.sql","pglite":{"extensions":{"vector":"@electric-sql/pglite/vector"}}},"codegen":{"out":"./src/queries","target":"python:asyncpg","options":null},"env_file":[".env"]}}"#;
